# 実装チェックリスト

[前半部分は変更なし]

## 4. 監査ログ機能の実装

### 実装方針:

#### Phase 1: Java 17 Record実装（現在のフェーズ）
1. データ構造
   - [x] `AuditLog`レコードクラスの実装 ← 完了（Java 17機能学習）
   - [x] `AuditEvent`シールドクラスの実装 ← 完了
   - [x] イベントタイプの定義 ← 完了
   - [x] インメモリキャッシュの実装 ← AuditLogInMemoryStorage完了
   - [ ] ログローテーション方式の設計

2. 基本機能
   - [x] インメモリログ管理サービスの実装 ← ConcurrentHashMapベースの実装完了
   - [x] Spring AOPによるログ記録の実装 ← @Auditedアノテーションとアスペクト完了
   - [x] 基本的なログ記録機能のテスト ← ストレージとアスペクトのテスト完了

#### Phase 2: データベース永続化（将来のフェーズ）
1. データベース設計
   - [ ] エンティティクラスの作成（AuditLogEntity）
   - [ ] データベーススキーマの設計
   - [ ] JPA永続化の実装
   - [ ] インデックス設計

2. 変換層の実装
   - [ ] Record-Entity変換の実装
   - [ ] Entity-Record変換の実装
   - [ ] 変換テストの作成

3. 移行計画
   - [ ] インメモリログのデータベース移行手順
   - [ ] 移行テストの実装
   - [ ] ロールバック手順の策定

### テスト実装:
1. 基本テスト
   - [x] AuditLogのユニットテスト ← 完了
   - [x] AuditEventのテスト ← 完了
   - [x] インメモリストレージのテスト ← AuditLogInMemoryStorageImplTest完了（5テストケース）
   - [x] アスペクトのテスト ← AuditAspectTest完了（3テストケース）
   - [ ] リポジトリのテスト ← Phase 2で実装予定

2. 統合テスト（Phase 2）
   - [ ] データベース永続化のテスト
   - [ ] 変換層のテスト
   - [ ] 移行処理のテスト

### 拡張計画:
1. Phase 1の改善
   - [ ] キャッシュサイズの制限実装
   - [ ] メモリ使用量の監視機能
   - [ ] 古いログのクリーンアップ

2. Phase 2の準備
   - [ ] エンティティ設計のレビュー
   - [ ] インデックス戦略の検討
   - [ ] 移行手順の詳細化

[以下は変更なし]
