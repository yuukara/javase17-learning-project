# 実装チェックリスト

## 目的
このチェックリストは以下の目的で使用されます：
1. 基本実装（Phase 1）の進捗管理
2. 実装項目の完了確認
3. レビュー時の確認項目として使用
4. 今後の開発タスクの可視化

## 記入ルール
- [ ] ：未着手の項目
- [x] ：実装完了した項目
- [?] ：確認が必要な項目
- [-] ：実装しないことが決定した項目

## 4. 監査ログ機能の実装

### 実装方針:

#### Phase 1: Java 17 Record実装
1. データ構造
   - [x] `AuditLog`レコードクラスの実装
   - [x] `AuditEvent`シールドクラスの実装
   - [x] イベントタイプの定義
   - [x] インメモリキャッシュの実装（AuditLogInMemoryStorage）
   - [?] ログローテーション方式の設計（Phase 2で詳細化予定）

2. キャッシュ機能
   - [x] Caffeine依存関係の追加
   - [x] キャッシュ設定クラスの実装
   - [x] キャッシュマネージャーの実装
   - [x] キャッシュ統計収集の実装
   - [ ] キャッシュサイズの制限実装
   - [ ] パフォーマンス最適化

3. 基本機能
   - [x] インメモリログ管理サービスの実装（ConcurrentHashMapベース）
   - [x] Spring AOPによるログ記録の実装（@Auditedアノテーション）
   - [x] 基本的なログ記録機能のテスト

#### Phase 2: データベース永続化
1. データベース設計
   - [ ] エンティティクラスの作成
     * AuditLogEntityの実装
     * バリデーション設定
     * インデックス定義
   - [ ] JPA永続化の実装
     * リポジトリインターフェース
     * カスタムクエリメソッド
   - [ ] パフォーマンス最適化
     * インデックス戦略
     * キャッシュ設定

2. 変換層の実装
   - [ ] Record-Entity変換の実装
     * 双方向マッピング
     * バリデーション
   - [ ] 変換テストの作成
     * 基本変換テスト
     * エッジケーステスト

3. ログローテーション実装
   - [ ] 保持期間管理
     * 90日ルール実装
     * アーカイブ処理
   - [ ] クリーンアップジョブ
     * 日次バッチ処理
     * エラーハンドリング
   - [ ] アーカイブ機能
     * JSON形式エクスポート
     * 圧縮処理

4. パフォーマンス最適化
   - [ ] キャッシュ実装
     * インメモリキャッシュ（1000件）
     * 二次キャッシュ設定
   - [ ] バッチ処理
     * 一括インサート
     * 非同期処理

### テスト計画:
1. 単体テスト
   - [ ] エンティティテスト
   - [ ] リポジトリテスト
   - [ ] 変換層テスト
   - [ ] ローテーションテスト

2. 統合テスト
   - [ ] データベース統合テスト
   - [ ] パフォーマンステスト
   - [ ] 長期実行テスト

3. 移行テスト
   - [ ] データ移行テスト
   - [ ] ロールバックテスト
   - [ ] 整合性検証

### 展開計画:
1. 準備フェーズ（1週間）
   - [ ] 開発環境セットアップ
   - [ ] テストデータ準備
   - [ ] モニタリング設定

2. 実装フェーズ（2週間）
   - [ ] エンティティ実装
   - [ ] リポジトリ実装
   - [ ] 変換層実装
   - [ ] ローテーション実装

3. テストフェーズ（1週間）
   - [ ] 単体テスト実行
   - [ ] 統合テスト実行
   - [ ] パフォーマンステスト実行

4. 移行フェーズ（1週間）
   - [ ] データ移行実行
   - [ ] 検証
   - [ ] 本番環境への適用

## 5. サービス層の基本実装

### インターフェースと実装の分離
1. 監査ログ関連サービス
   - [x] AuditLogService
     * インターフェースの作成
     * 実装クラスの移動（AuditLogServiceImpl）
   - [x] AuditLogArchiveService
     * インターフェースの作成
     * 実装クラスの移動（AuditLogArchiveServiceImpl）

2. 基本サービス
   - [ ] AccessControlService
     * インターフェースの作成
     * 実装クラスの移動（AccessControlServiceImpl）
   - [ ] UserService
     * インターフェースの作成
     * 実装クラスの移動（UserServiceImpl）
   - [ ] PasswordEncodingService
     * インターフェースの作成
     * 実装クラスの移動（PasswordEncodingServiceImpl）

3. 認証関連サービス
   - [ ] CustomUserDetailsService
     * インターフェースの作成
     * 実装クラスの移動（CustomUserDetailsServiceImpl）
   - [ ] AuditLogCacheService
     * インターフェースの作成
     * 実装クラスの移動（AuditLogCacheServiceImpl）

4. パッケージ構成の整理
   - [x] entityパッケージの作成
   - [ ] serviceパッケージのインターフェース整理
   - [ ] service.implパッケージの作成
   - [x] cacheパッケージの作成

5. テスト
   - [x] AuditLogServiceのテスト実装
   - [x] AuditLogArchiveServiceのテスト実装
   - [ ] その他サービスの単体テスト修正
   - [ ] 依存性注入の確認
