# 実装チェックリスト

[前半部分は変更なし]

## 4. 監査ログ機能の実装

### 実装方針:

#### Phase 1: Java 17 Record実装（完了）
1. データ構造
   - [x] `AuditLog`レコードクラスの実装 ← 完了（Java 17機能学習）
   - [x] `AuditEvent`シールドクラスの実装 ← 完了
   - [x] イベントタイプの定義 ← 完了
   - [x] インメモリキャッシュの実装 ← AuditLogInMemoryStorage完了
   - [x] ログローテーション方式の設計 ← Phase 2で詳細化

2. 基本機能
   - [x] インメモリログ管理サービスの実装 ← ConcurrentHashMapベースの実装完了
   - [x] Spring AOPによるログ記録の実装 ← @Auditedアノテーションとアスペクト完了
   - [x] 基本的なログ記録機能のテスト ← ストレージとアスペクトのテスト完了

#### Phase 2: データベース永続化（詳細設計完了）
1. データベース設計
   - [ ] エンティティクラスの作成
     * AuditLogEntityの実装
     * バリデーション設定
     * インデックス定義
   - [ ] JPA永続化の実装
     * リポジトリインターフェース
     * カスタムクエリメソッド
   - [ ] パフォーマンス最適化
     * インデックス戦略
     * キャッシュ設定

2. 変換層の実装
   - [ ] Record-Entity変換の実装
     * 双方向マッピング
     * バリデーション
   - [ ] 変換テストの作成
     * 基本変換テスト
     * エッジケーステスト

3. ログローテーション実装
   - [ ] 保持期間管理
     * 90日ルール実装
     * アーカイブ処理
   - [ ] クリーンアップジョブ
     * 日次バッチ処理
     * エラーハンドリング
   - [ ] アーカイブ機能
     * JSON形式エクスポート
     * 圧縮処理

4. パフォーマンス最適化
   - [ ] キャッシュ実装
     * インメモリキャッシュ（1000件）
     * 二次キャッシュ設定
   - [ ] バッチ処理
     * 一括インサート
     * 非同期処理

### テスト計画:
1. 単体テスト
   - [ ] エンティティテスト
   - [ ] リポジトリテスト
   - [ ] 変換層テスト
   - [ ] ローテーションテスト

2. 統合テスト
   - [ ] データベース統合テスト
   - [ ] パフォーマンステスト
   - [ ] 長期実行テスト

3. 移行テスト
   - [ ] データ移行テスト
   - [ ] ロールバックテスト
   - [ ] 整合性検証

### 展開計画:
1. 準備フェーズ（1週間）
   - [ ] 開発環境セットアップ
   - [ ] テストデータ準備
   - [ ] モニタリング設定

2. 実装フェーズ（2週間）
   - [ ] エンティティ実装
   - [ ] リポジトリ実装
   - [ ] 変換層実装
   - [ ] ローテーション実装

3. テストフェーズ（1週間）
   - [ ] 単体テスト実行
   - [ ] 統合テスト実行
   - [ ] パフォーマンステスト実行

4. 移行フェーズ（1週間）
   - [ ] データ移行実行
   - [ ] 検証
   - [ ] 本番環境への適用

[以下は変更なし]

## 5. サービス層の基本実装

### インターフェースと実装の分離
1. 基本サービス
   - [ ] AccessControlService
     * インターフェース作成
     * 実装クラスの移動
   - [ ] UserService
     * インターフェース作成
     * 実装クラスの移動
   - [ ] PasswordEncodingService
     * インターフェース作成
     * 実装クラスの移動

2. 認証関連サービス
   - [ ] CustomUserDetailsService
     * インターフェース作成
     * 実装クラスの移動

3. パッケージ構成の整理
   - [ ] serviceパッケージのインターフェース整理
   - [ ] service.implパッケージの作成

4. 基本テスト
   - [ ] 単体テストの修正
   - [ ] 依存性注入の確認
